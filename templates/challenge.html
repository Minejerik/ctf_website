{% extends 'base.html' %}

{% block title %}
{{challenge.name}}
{% endblock %}

{% block body_style %}
style="overflow-x: hidden;"
{% endblock %}

{% set download = '<?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000"><path d="M6 20L18 20" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12 4V16M12 16L15.5 12.5M12 16L8.5 12.5" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'%}

{% block content %}
<br><br>
<div class="row">
    <div class="col"></div>
    <div class="col">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{challenge.name}}</h5>
                <hr>
                <p class="card-text">{{challenge.desc}}</p>
                <br><br>
            </div>

            <div class="card-footer">
                <form action="javascript:handle_submission()">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="{{flag_template}}" aria-label="flag" aria-describedby="submit" id="flag">
                        <button class="btn btn-outline-success" type="submit" id="submit">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col"></div>
</div>

<script>
async function handle_submission_async() {
    const challenge_id = {{challenge.id}}
    const flag = document.getElementById("flag")

    const flag_string = flag.value

    let resp = await fetch("/api/challenge/submission", {
        method: "POST",
        cache: "no-cache",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({id:challenge_id, flag:flag_string})
    })

    const data = await resp.json()

    alert(data.message)

}

function handle_submission(){
    handle_submission_async()
}

</script>

{% endblock %}